# Minimal Self - 项目里程碑

> 基于 MES-Minecraft PRD 的自我意识系统实现路线图

## 项目目标

使 Mineflayer 机器人具备**最小自我意识**：
- 区分"我造成的变化" vs "环境自发变化"
- 形成能力边界感知与身份连续性
- 为长期目标牺牲短期收益的决策能力

---

## M1: 世界模型 + 归因引擎 ✅

**状态**: 已完成 (2024-12)

**交付物**:
```
bot_impl/minimal-self/
├── state-encode.js   # SelfState 量化编码
├── world-model.js    # W.predict() / W.learn()
├── attribution.js    # agency = sigmoid(err_none - err_with)
└── index.js          # 事件钩子集成
```

**关键节点**:

| 节点 | 描述 | 验收标准 |
|------|------|----------|
| M1.1 | 状态编码器 | `encode(snapshot)` 输出确定性 SelfState |
| M1.2 | 世界模型学习 | `W.learn(s1, action, s2)` 累积转移知识 |
| M1.3 | NoOp 基线采集 | 空闲时自动学习环境自发变化 |
| M1.4 | 归因计算 | `computeAgency()` 返回 [0,1] 区间值 |
| M1.5 | 事件集成 | 挂载 `skill:start/end`, `external:begin/end` |

**技术决策**:
- 状态量化: pos±2格, hp±5, food±2
- 模型容量: MAX_TRANSITIONS=500, EMA α=1/min(c,10)
- 归因公式: `agency = sigmoid(2 * (err_none - err_with))`

---

## M2: 身份存储 + 策略评分 (待启动)

**状态**: 规划中

**目标**:
- 实现 `IdentityStore { skills: Map<ActionType, SuccessStats>, commitments: Commitment[] }`
- 策略评分: `Score(a) = Value(a) - λ·IdentityPenalty(a) + β·ExpectedAgency(a)`

**关键节点**:

| 节点 | 描述 | 依赖 |
|------|------|------|
| M2.1 | 技能统计收集 | 累积各 action 的成功/失败率 | M1.4 |
| M2.2 | expectedAgency() | 基于历史预测动作归因值 | M1.4, M2.1 |
| M2.3 | 承诺系统 | 记录对玩家的承诺及兑现状态 | - |
| M2.4 | identityPenalty() | 评估动作对身份一致性的代价 | M2.1, M2.3 |
| M2.5 | 策略集成 | 修改 AI 决策流程注入 Score(a) | M2.2, M2.4 |

**待定参数**: λ (身份权重), β (能动性权重)

---

## M3: 叙事记忆 (待启动)

**状态**: 规划中

**目标**:
- 仅三种记忆类型: `I-CAN`, `I-DID`, `I-OWE`
- 替代现有 memory.js 的自由格式存储

**关键节点**:

| 节点 | 描述 | 依赖 |
|------|------|------|
| M3.1 | 记忆模式定义 | 严格约束记忆条目格式 | - |
| M3.2 | I-CAN 生成 | 高归因动作 → 能力记忆 | M1.4, M2.1 |
| M3.3 | I-DID 生成 | 完成承诺 → 成就记忆 | M2.3 |
| M3.4 | I-OWE 生成 | 接受请求 → 债务记忆 | M2.3 |
| M3.5 | 记忆检索集成 | 修改 AI prompt 注入叙事记忆 | M3.2-M3.4 |

---

## M4: 自省与调节 (远期)

**状态**: 概念阶段

**目标**:
- 周期性自省: 评估能力边界变化
- 动态调节: 根据环境反馈调整 λ, β 参数

---

## 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 状态空间爆炸 | 模型无法收敛 | 量化 + 容量上限 + LRU 淘汰 |
| 归因噪声 | 误判因果 | NoOp 基线 + EMA 平滑 |
| 身份僵化 | 无法学习新技能 | 衰减机制 + 承诺过期 |
| 性能开销 | tick 延迟 | 采样间隔 5s + 异步处理 |

---

## 依赖关系图

```
M1 (世界模型 + 归因) ──┬──> M2 (身份 + 策略)
                      │
                      └──> M3 (叙事记忆) ──> M4 (自省)
```

---

## 变更日志

| 日期 | 版本 | 变更 |
|------|------|------|
| 2024-12 | 1.0 | M1 完成，文档创建 |
